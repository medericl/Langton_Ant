#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <time.h>

#include "grid.h"



void grid_free(char **grid)
{
    for (size_t i = 0; i < HEIGHT; i++)
        free(grid[i]);
    free(grid);
}

static void sleep_ms(long ms)
{
#if defined(_WIN32)
    Sleep(ms);                     // Windows
#else
    struct timespec ts;
    ts.tv_sec = ms / 1000;
    ts.tv_nsec = (ms % 1000) * 1000000L;
    nanosleep(&ts, NULL);          // POSIX
#endif
}

void display(char** grid, char life, char death)
{
    printf("\033[H\033[J");
    for (size_t j = 1; j < HEIGHT - 1; j++) {
        for (size_t i = 1; i < WIDTH - 1; i++)
            if (grid[j][i])
                putchar(life);
            else
                putchar(death);

        putchar('\n');
    }

    fflush(stdout);
    sleep_ms(DELAY);
}


char **grid_init(void)
{
    char **grid = calloc(HEIGHT, sizeof(char *));
    if (!grid) {
        perror("malloc");
        exit(EXIT_FAILURE);
    }

    for (size_t i = 0; i < HEIGHT; i++) {
        grid[i] = calloc(WIDTH, sizeof(char));
        if (!grid[i]) {
            perror("malloc");
            grid_free(grid);
            exit(EXIT_FAILURE);
        }
    }
    return grid;
}

void grid_pattern(char **grid)
{
    size_t pattern_width = 40;
    size_t pattern_height = 50;

    char pattern[50][40] =
    {

        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 1,1,1,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,1,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0,0,0},
        {0,0,0,0,1,1,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,1,1,0,0,0,0,0},
        {0,0,0,0,1,0,0,1,1,1,  0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,0},
        {0,0,0,0,1,0,0,0,0,1,  1,1,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,1,1,1,0,0,  1,1,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,1,1,0,0,0,1,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,1,1,1,0,0,0,0, 0,1,1,0,0,1,0,1,0,0},
        {0,0,0,0,0,1,1,1,0,0,  1,1,0,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0,0,0, 1,0,1,0,0,0,1,0,0,0},
        {0,0,0,0,1,0,0,0,0,1,  1,1,0,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,0,1, 1,0,0,0,0,0,0,0,0,0},

        {0,0,0,0,1,0,0,1,1,1,  0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,1,1,1,1, 0,1,0,0,0,0,0,0,0,0},
        {0,0,0,0,1,1,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,1,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,1, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,1,0, 1,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,1,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,0,1, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},

        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,0,1,0, 0,0,0,0,0,0,1,1,0,1, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,0,0,0, 0,1,1,0,0,0,1,1,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,1,1, 1,0,0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,1,1,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,1,1, 1,0,0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,0,0,0, 0,1,1,0,0,0,1,1,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,0,1,0, 0,0,0,0,0,0,1,1,0,1, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},

        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,0,1, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,1,1,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,1,0, 1,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,1, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},

        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,1,0,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,1,0,0, 0,0,0,0,1,1,0,0,0,0, 0,0,0,0,0,0,0,0,1,1},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,1,0,0,0,1, 0,0,0,0,1,1,0,0,0,0, 0,0,0,0,0,0,0,0,1,1},
        {0,0,0,0,1,1,0,0,0,0,  0,0,0,0,1,0,0,0,0,0, 1,0,0,0,1,1,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,1,1,0,0,0,0,  0,0,0,0,1,0,0,0,1,0, 1,1,0,0,0,0,1,0,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,1,0,0,0,1, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},
        {0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,1,1,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0},

    };

    //size_t mid_w = (WIDTH / 2) - pattern_width/2;
    //size_t mid_h = (HEIGHT / 2) - (pattern_height/2);
    //for (size_t j = 0; j < pattern_height; j++)
        //for (size_t i = 0; i < pattern_width; i++)
            //grid[j+ mid_h][i + mid_w] = pattern[j][i];

}


void grid_random(char **grid)
{
    srand(time(NULL));
    for (size_t j = 1; j < HEIGHT - 1; j++)
        for (size_t i = 1; i < WIDTH - 1; i++)
                grid[j][i] = rand() % 2;
}
